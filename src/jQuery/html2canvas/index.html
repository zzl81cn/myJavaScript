<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>html2canvas</title>
</head>
<body>
<div id="capture" style="padding: 10px; background: #f5da55">
  <button id="exportPDF">exportpdf</button>
  <button id="exportPDF2">exportPDF2</button>
<!--  <h4 style="color: #000; ">Hello world!</h4>-->
  <div class="page_re"><img src="axure-crx20200612152243.png" alt=""></div>
  <div class="page_re"><img src="axure-crx20200612152243.png" alt=""></div>
  <div class="page_re"><img src="axure-crx20200612152243.png" alt=""></div>
  <div class="page_re"><img src="axure-crx20200612152243.png" alt=""></div>
  <div class="page_re"><img src="axure-crx20200612152243.png" alt=""></div>
</div>

</body>
<script type="text/javascript" src="jquery-3.5.1.js"></script>
<script type="text/javascript" src="html2canvas.js"></script>
<script type="text/javascript" src="jspdf.min.js"></script>
<!--<script src="https://unpkg.com/jspdf@latest/dist/jspdf.min.js"></script>-->
<script type="text/javascript">
  /*html2canvas(document.querySelector("#capture")).then(canvas => {
      document.body.appendChild(canvas)
  });*/
  $(function () {
    $('#exportPDF').on('click', function () {
      console.log('docs', $('#docs'))
    })

    let imgStr = "data:image/png;base64,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";

  })

  $(function () {
    $('#exportPDF2').on('click', function () {
      // console.log('docs', $('#docs'))
      makeMpdf()
    })

    var pages = $(".page_re")
    function makeMpdf() {
      // if (confirm("您确认下载该PDF文件吗?")) {
        /*1*/
        // var pdf = new jsPDF('p', 'pt', 'a4');
        // // 设置打印比例 越大打印越小
        // // pdf.internal.scaleFactor = 2.7;
        // var options = {
        //     pagesplit: true, //设置是否自动分页
        //     "background": '#FFFFFF'   //如果导出的pdf为黑色背景，需要将导出的html模块内容背景 设置成白色。
        // };
        // var printHtml = $('#pdf').get(0);   // 页面某一个div里面的内容，通过id获取div内容
        // layer.msg('正在生成，请稍等', {
        //     icon: 16,
        //     shade: 0.5
        // })
        // // $('.operbox a.btn').html('正在生成...')
        // // $('.operbox a.btn').attr("disabled", true);
        // pdf.addHTML(printHtml, 15, 15, options, function () {
        //     pdf.save('报告.pdf');
        // });
        /*2*/
        // layer.msg('正在生成，请稍等', {
        //     icon: 16
        //     , shade: 0.5
        // })
        // var pdf;
        // var width;
        // var height;
        // $(pages).each(function () {
        //     var mainRight = $(this);
        //     html2canvas(mainRight, {
        //         allowTaint: true,
        //         dpi: 96, // 提升画面质量，但是会增加文件大小
        //         background: '#FFFFFF',
        //         onrendered: function (canvas) {
        //
        //             var contentWidth = canvas.width;
        //             var contentHeight = canvas.height;
        //
        //             var pageData = canvas.toDataURL('image/jpeg', 1.0);
        //
        //             var pdfWidth = (contentWidth + 10) / 2 * 0.75;
        //             var pdfHeight = (contentHeight + 200) / 2 * 0.75; // 500为底部留白
        //
        //             var imgWidth = pdfWidth;
        //             var imgHeight = (contentHeight / 2 * 0.75); //内容图片这里不需要留白的距离
        //             // width += pdfWidth;
        //             // height += pdfHeight;
        //             var pdf = new jsPDF('', 'pt', [pdfWidth, pdfHeight]);
        //             pdf.addImage(pageData, 'jpeg', 0, 0, imgWidth, imgHeight);
        //             pdf.addPage();
        //         }
        //     })
        // })
        // pdf.save('体检报告_' + new Date().getTime() + '.pdf');
        //
        // console.log(js_getDPI());
        // return;
        /*3*/
        /*layer.msg('正在生成，请稍等', {
          icon: 16,
          shade: 0.5
        })*/
        // var element = document.getElementById("pdf");
        var pdf = new jsPDF('p', 'mm', 'a4');    //A4纸，纵向
        var length = $(pages).length;
        var img_arr = [];
        // var pages = $(pages).toArray().reverse();
        debugger
        $(pages).each(function (index,value) {
          //$(this).scrollTop();
          // console.log($(this).offset().top)
          // return;
          // childElementCount nodeCount childNodes
          console.log('tag top ', $(this).offset().top);
          window.scrollTo(0,$(this).offset().top);//最为关键的地方 需要滚动到指定标签  否则图片不全
          html2canvas($(this), {
            // useCORS: true,
            // allowTaint:true,
            // height: $("#pdf").outerHeight(),
            logging: false,
            // width:window.screen.availWidth,
            // height:window.screen.availHeight,
            windowWidth:document.body.scrollWidth,
            windowHeight:document.body.scrollHeight,
            background: '#FFFFFF',
            x:0,
            scrollY:$(this).offset().top,
            async:false,//同步执行
          }).then(function (canvas) {
            console.log('eeeeee');
            //onrendered: function (canvas) {
            //  var ctx = canvas.getContext('2d');
            //  var bl = canvas.height/22676;
            a4w = 210, a4h = 297;
            var img = canvas.toDataURL('image/png', 1.0);
            // $('.images').append('<image src="'+img+'" />')
            pdf.addImage(img, 'PNG', 0, 0, a4w, a4h);
            //添加图像到页面，保留10mm边距

            //renderedHeight += imgHeight;
            //if (renderedHeight < canvas.height)
            delete canvas;

            console.log(index)
            if(index == (length - 1)){
              var name = $('#order_name').val();
              pdf.save(name + '体检报告.pdf');
              return;
            }else{
              pdf.addPage();//如果后面还有内容，添加一个空页
            }
            // layer.closeAll();
            // layer.msg('正在生成第'+(index+2)+'张...')
            console.log('正在生成第' + index + 2 + '张...')
          }).catch(function (error) {
            console.log('e', error)
          });
        });
        //console.log(1);
        /*后端*/
        // var id = $('#order_id').val();
        // window.location.href = '/check_site/index/gene_pdf?id='+id;
      // } // confirm end quote
    }
  })
</script>
</html>
