<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Element index (Closure)</title>
</head>
<body>
	<!--https://segmentfault.com/a/1190000000652891-->
	<!--1.函数嵌套函数
		2.函数内部可以引用外部的参数和变量
		3.参数和变量不会被垃圾回收机制回收-->

	<!--使用闭包的好处
		1.希望一个变量长期驻扎在内存中
		2.避免全局变量的污染
		3.私有成员的存在-->


	<!--在循环中直接找到对应元素的索引-->
	<ul>
		<li>123</li>
		<li>456</li>
		<li>789</li>
	</ul>
	<script>
		/*function aaa() {
			var a = 1;
			return function () {
				alert(a++);
			}
		}
		var fun = aaa();
		fun();
		fun();
		fun = null;*/

		// 全局变量的累加
		/*var a = 1;
		function globalA() {
			a++;
			alert(a);
		}
		// 2
		globalA();
		// 3
		globalA();*/

		// 局部变量
		/*function scopeA() {
			var a = 1;
			a++;
			alert('ScopeA '+ a);
		}
		// 2
		scopeA();
		// 2
		scopeA();*/

		// 局部变量累加
		/*function outerA() {
			var a = 1;
			return function () {
				a++;
				alert(a);
			}
		}
		var out = outerA();
		// var out = outerA.call();
		// 2
		out();
		// 3
		out();*/

		// 模块化代码，减少全局变量污染
		// outerA为外部匿名函数的返回值
		/*var outerA = (function () {
			var a = 1;
			return function () {
				a++;
				alert(a);
			}
		})();
		// 调用一次outerA函数，其实是调用里面内部函数的返回值
		outerA();
		outerA();*/

		// Private member exist
		/*var privateA = (function () {
			var a = 1;
			function aaa() {
				a++;
				alert(a);
			};
			function bbb() {
				a++;
				alert(a);
			};
			// json construction
			return {
				a:aaa,
				b:bbb
			}
		})();
		// 2
		privateA.a();
		// 3
		privateA.b();*/

		// 使用匿名函数实现累加
		function box(){
			var age = 100;
			return function(){          //匿名函数
				age++;
				return age;
			};

		}
		var b = box();
		alert(b());
		alert(b());    //即alert(box()())；
		alert(b());
		alert(b);            //     function () {
		//   age++;
		// return age;
		//       }

		b = null；  //解除引用，等待垃圾回收

		//在循环中直接找到对应元素的索引
		/*window.onload = function () {
			var aLi = document.getElementsByTagName('li');
			for(var i = 0; i<aLi.length; i++) {
				// alert(i);
				// 当点击时for循环已经结束
				aLi[i].onclick = function () {
					alert(i);
				}
			}
		}*/
		// 利用闭包重写
		window.onload = function () {
			var aLi = document.getElementsByTagName('li');
			for(var i = 0; i<aLi.length; i++) {
				(function (i) {
					aLi[i].onclick = function() {
						alert(i);
					}
				})(i)
			}
		}
	</script>
</body>
</html>